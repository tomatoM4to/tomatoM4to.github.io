# Http 상태 코드

Http 메서드는 Client 가 Server 에게 요청을 보낼 때 사용되는 방법이라면, Http 상태 코드는 Server 가 Client 의 요청에 대한 응답을 나타내는 코드임

* 100번대 : 정보성 상태 코드
* 200번대 : 성공 상태 코드
* 300번대 : 리다이렉션 상태 코드
* 400번대 : 클라이언트 오류 상태 코드
* 500번대 : 서버 오류 상태 코드

100번대는 거의 사용하지 않음, 이또한 완전히 구분되는 경우보다 모호한 경우가 많기에 개발자가 어떻게 설계하는지에 달려있음

다른 상태 코드는 명확하다 300번대가 살짝 모호할 수 있으니 따로 설명하겠음

## Redirect 상태 코드

먼저 공식문서에서 말하는 Redirect 상태 코드의 정의를 살펴보자

> The 3xx (Redirection) class of status code indicates that further action needs to be taken by the user agent in order to fulfill the request. There are several types of redirects
>
> [https://www.rfc-editor.org/rfc/rfc9110#name-redirection-3xx](https://www.rfc-editor.org/rfc/rfc9110#name-redirection-3xx)

상황으로 설명하는것이 가장 이해하기가 쉬운데, 이런 상황을 가정 할 수 있음

> 1. 사용자가 A 페이지를 요청했는데, 해당 페이지가 B 페이지로 이동되었음
> 2. 이때 서버는 `301 Moved Permanently` 상태 코드를 반환하고, `Location` 헤더에 B 페이지의 URL을 포함하여 클라이언트에게 알려줌
> 3. Client 는 이 정보를 바탕으로 자동으로 B 페이지를 새로 요청하게 됨 (브라우저의 경우 자동 처리됨)

이를 HTTP 메시지 흐름으로 표현하면 다음과 같음

```
1. 클라이언트 → 서버
GET /A HTTP/1.1
Host: example.com

2. 서버 → 클라이언트
HTTP/1.1 301 Moved Permanently
Location: /B

3. 클라이언트 → 서버
GET /B HTTP/1.1
Host: example.com

4. 서버 → 클라이언트
HTTP/1.1 200 OK
Body: (B 페이지의 실제 콘텐츠)
```

이렇듯 Client 즉 브라우저는 300번대 상태 코드를 받으면 헤더에 `Location` 이라는 필드를 확인하고, 해당 URL로 자동으로 요청을 보내게 됨

## 영구적인 Redirect

하지만 300번대 코드별로 브라우저가 자동으로 요청을 보내는 방식이 다름

먼저 영구적인 리다이렉션에 해당하는 상태 코드는 다음과 같음
- 301 Moved Permanently
- 308 Permanent Redirect

결론부터 말하자면 308 코드를 쓰는것이 좋음

RFC 9110 에서 말하는 301 에 대한 설명중 다음과 같은 설명이 포함됨

> For historical reasons, a user agent MAY change the request method from POST to GET for the subsequent request. If this behavior is undesired, the 308 (Permanent Redirect) status code can be used instead.

일단 이러한 설명이 생긴 이유는 다음과 같음

```
1. 클라이언트 → 서버
POST /A HTTP/1.1
Host: example.com

2. 서버 → 클라이언트
HTTP/1.1 301 Moved Permanently
Location: /B
```

위 예시와 다른점은 첫번째의 `클라이언트 → 서버` 의 Method 가 `POST` 라는 점임

이제 이때 3번째의 `클라이언트 → 서버` 는 어떤 Method 를 사용해야 할까? 직관적으로 `GET` 을 사용해야 할 것 같지만 실제론 `GET` 과 `POST` 둘다 사용될 수 있다라는 의미

이렇게 불확실함을 줄이기 위해선 `308 Permanent Redirect` 상태 코드를 사용하는 것이 좋음, 만약 `308` 상태 코드를 사용한다면, 클라이언트는 원래의 요청 메서드인 `POST` 를 그대로 유지하여 `/B` 페이지로 요청을 보낼 것임

첫번째 요청이 `GET` 이라면 둘다 사용해도 무방함

추가적인 예기로, 영구적인 Redirect 는 주로 URL 변경이나 리소스 이동 시 사용됨, 예를 들어, 웹사이트의 구조가 변경되어 특정 페이지가 다른 URL로 이동한 경우에 사용됨, 이러한 경우 크롤러나 검색엔진에 큰 영향을 끼칠 수 있음

## 임시적인 Redirect

영구적이라면 일시적인 Redirect 도 있다는 뜻, 관련된 예기는 위와 비슷하니 간단히 표로 정리하겠음

| 상태 코드 | 설명 |
| ---------- | ---- |
| 302 Found | 재요청 Method 변경 가능 |
| 303 See Other | 재요청 Method GET 으로 번경 |
| 307 Temporary Redirect | 재요청 Method 변경 하지 않음 |