# 802.11 wireless LAN
WIFI 라고도 불림

사무실, 가정, 교육기관, 카페, 공항, 길거리 에서도 자연스럽게 접할 수 있는 가장 중요한 네트워크 접속 기술

1990년대 여러 무선 랜 관련 기술 및 표준이 개발되었으니 그중 가장 성공적인 기술이 802.11 시리즈

| IEEE 802.11 표준안 | 연도 | 최대 데이터 전송률 | 거리 | 주파수 범위 |
|-------------------|------|-------------------|------|------------|
| 802.11b           | 1999 | 11 Mbps           | 30m  | 2.4GHz     |
| 802.11g           | 2003 | 54 Mbps           | 30m  | 2.4GHz     |
| 802.11n           | 2009 | 600 Mbps          | 70m  | 2.4GHz, 5GHz |
| 802.11ac          | 2013 | 3.47 Gbps         | 70m  | 5GHz       |
| 802.11ax          | 2020 | 14 Gbps           | 70m  | 2.4GHz, 5GHz |
| 802.11.af         | 2014 | 35~560 Mbps       | 1km  | 54~790MHz |
| 802.11.ah         | 2017 | 347 Mbps          | 1km  | 900MHz    |

n, ac, ax는 각각 WIFI 4, 5, 6로 불림

af, ah는 좀더 먼 거리에서 동작하며 IoT, 센서 네트워크, 측정 애플리케이션을 활용하기 위한 용도

2.4GHz 대역은 비허가 대역이며, 해당 영역의 장치들은 무선 전화 및 전자레인지 등가전제품과 주파수 경쟁을 하게 됨, 5GHz 대역은 전력 수준이 동일할 경우 전송 거리가 더 짧고 다중 경로 전파의 영향을 더 많이 받음


## 구조
BSS: Basic Service Set 으로 불리며, 하나 이상의 무선 Host와 하나의 기지국(Base station) 으로 구성, 보통 AP(Access Point)라고 불림

전형적인 Home Network에선 BSS를 인터넷으로 연결하는 AP와 라우터가 각각 필요, 이들은 대개 하나의 제품으로 통합 구현 되어 있음

이더넷 장치처럼 AP는 6바이트의 MAC 주소를 가짐, MAC 주소는 IEEE에 의해 관리되며 이론적으로 전세계에서 유일성을 가짐

MAC 주소는 스테이션의 어댑터 펌웨어에 저장되어 있음

AP를 가진 무선랜을 인프라스트럭처 무선랜 이라고 함, 이프라스트럭처 즉 네트워크 인프라스트럭처는 AP, 그리고 AP를 인터넷 라우터와 연결해주는 유선 이더넷 구조를 통칭

### 에드혹 네트워크
* 영어로 임시(임기변통)의 뜻을 갖음

* 독립 단말끼리 외부의 도움없이 자기들 만으로 자율적인 임시적 망을 구성함을 뜻함

* 한편 - 임시적 망이 이동(Mobile)도 하는 이동 임시망의 경우는 MANET이라고도 불리움

[출처] Ad-hoc 네트워크이란?|작성자 솔루션 헌터

***

# 결합
네트워크 관리자가 AP를 설치할때 AP 에게 하나 또는 두 단어로 된 SSID를 할당, WIFI 선택 화면에 보이는 네트워크 이름이 바로 SSID

와이파이 정글: 주변에 많은 WIFI가 있을때, 어떤 네트워크에 연결해야 할지 결정하기 어려운 상황

802.11 표준은 AP가 주기적으로 비컨 프레임(becon frame)을 방출할것을 요구, 비컨 프레임은 AP의 SSID와 MAC 주소가 포함

비컨 프레임으로부터 사용 가능한 AP들의 정보를 얻은 무선 스테이션은 사용자가 선택한 AP에 결합을 시도

이 방식을 수동적 스캐닝(passive scanning) 이라고 함

반대로 무선 호스트는 능동적 스캐닝(active scanning)을 통해 AP에게 직접 요청을 보내는 방식도 있음, 이때는 무선 스테이션이 영역 안에 있는 AP들에게 탐사용 프로브(probe) 프레임을 방송하는 방식

AP는 프로브 프레임을 받으면 응답 프레임을 보내고, 무선 스테이션은 이 응답 프레임을 받아서 결합을 시도, 핸드셰이크 과정을 통해 결합이 이루어짐

***

# 802.11 MAC 프로토콜
802.11은 무선 LAN(WLAN)의 표준이며, 특히 MAC(Media Access Control) 계층에서 데이터 전송을 효율적으로 관리하기 위해 독특한 프로토콜과 메커니즘을 사용합니다. 주요 키워드를 중심으로 설명하겠습니다.

MAC 계층은 데이터가 여러 장치 간에 충돌 없이 전송되도록 통신 채널을 관리합니다.
802.11은 유선 네트워크와 달리, 공유된 무선 매체를 사용하므로 충돌 가능성이 높아 이를 해결하기 위한 독특한 프로토콜이 필요합니다.

## CDMA(Code Division Multiple Access)
* 설명: 802.11에서는 주파수를 효율적으로 사용하기 위해 CDMA 기반의 물리 계층 기술을 사용합니다.
* 역할: 각 데이터 스트림에 고유 코드를 부여해 동시에 여러 사용자가 동일한 주파수를 사용할 수 있도록 합니다.

## CSMA/CA (Carrier Sense Multiple Access with Collision Avoidance)
* 설명: 802.11은 충돌 회피(CA) 메커니즘을 사용하는 CSMA 방식을 채택합니다.
무선 네트워크에서는 충돌 후 신호를 감지하기 어렵기 때문에 CSMA/CD(Collision Detection)는 사용되지 않습니다.
* 작동 방식:
    1. 송신 장치는 데이터 전송 전에 채널을 감지(Carrier Sense)합니다.
    2. 채널이 비어 있으면 데이터를 전송하고, 사용 중이라면 대기(Backoff)합니다.
    3. 일정 시간 동안 채널이 비어 있음을 감지하면 데이터를 전송합니다.

CSMA/CD (Collision Detection)를 사용하지 않는 이유
* 유선 네트워크에서는 충돌이 발생하면 충돌 신호를 감지하여 데이터를 재전송할 수 있습니다.
* 무선 네트워크에서는 충돌 후 신호를 감지하는 것이 매우 어렵기 때문에 CSMA/CA를 대신 사용합니다.

## Link-Layer Acknowledgement
1. 채널이 비어 있으면 바로 데이터 전송 준비
    * 스테이션(장치)은 무선 채널을 확인합니다.
    * 채널이 사용 중이 아니면, DIFS라는 짧은 시간 동안 기다립니다. 이 시간 동안에도 채널이 계속 비어 있으면 데이터를 전송합니다.
2. 채널이 사용 중이면 대기(백오프)
    * 만약 채널이 이미 다른 장치에 의해 사용 중이라면, 스테이션은 기다려야 합니다.
    * 기다릴 시간은 **임의의 값(백오프 시간)**으로 결정되며, 이 값을 카운트다운합니다.
3. 백오프 카운터가 0이 되면 데이터 전송
    * 대기 시간이 끝나면(카운터가 0에 도달하면), 스테이션은 데이터를 전송합니다.
    * 데이터를 보낸 후, 수신 측으로부터 **ACK(응답)**을 기다립니다.
4. ACK를 받으면 전송 성공 확인
    * 송신 장치가 ACK(응답 메시지)를 받으면 데이터가 제대로 전달되었음을 확인합니다.
    * 만약 ACK를 받지 못하면 데이터가 손실되었거나 충돌이 발생했음을 의미하며, 데이터를 다시 전송합니다.

## RTS, CTS
숨은 터미널 문제란?

**숨은 터미널 문제(Hidden Terminal Problem)**은 무선 네트워크에서 발생하는 전송 충돌 문제입니다.
무선 장치 A와 C가 서로의 신호를 직접 감지하지 못하지만, 중간에 위치한 B와 통신하려고 할 때 발생합니다.
A와 C는 서로 보이지 않기 때문에 동시에 B에게 데이터를 전송하려고 하면 충돌이 발생할 수 있습니다.

RTS(Request to Send)와 CTS(Clear to Send)는 숨은 터미널 문제를 해결하기 위한 충돌 회피(Collision Avoidance) 프로토콜입니다.

1. RTS(Request to Send)
    * 송신 장치(A)가 데이터를 전송하기 전에 RTS 패킷을 중간 기지국(B)으로 보냅니다.
    * RTS 패킷은 "내가 데이터를 전송하려고 하는데, 채널을 사용할 수 있을까요?"라는 요청입니다.
2. CTS(Clear to Send)
    * 수신 장치(B)는 채널이 사용 가능하면 CTS 패킷을 보내 "채널 사용 허가"를 부여합니다.
    * CTS 패킷은 네트워크의 다른 장치들에게도 전달되어 "지금은 A가 데이터를 전송 중이니 기다려라"라는 신호를 보냅니다.
3. 데이터 전송
    * 송신 장치(A)는 CTS 신호를 받은 후 데이터를 전송합니다.
4. ACK
    * 수신 장치(B)는 데이터를 성공적으로 받으면 ACK(응답)을 보냅니다.

TS/CTS 메커니즘은 네트워크의 모든 장치가 RTS/CTS 패킷을 통해 현재 통신 상황을 알 수 있게 합니다.

예를 들어:
1. 장치 A가 RTS를 보내고, 장치 B가 CTS를 응답하면, 장치 C는 CTS를 감지하고 데이터를 전송하지 않고 대기합니다.
2. 이렇게 해서 A와 C의 충돌을 방지할 수 있습니다.

***

# IEEE 802.11 프레임 구조
IEEE 802.11의 프레임 구조는 무선 네트워크에서 데이터를 안전하고 효율적으로 전송하기 위해 다양한 필드로 구성됩니다. 각 필드의 역할을 중심으로 정리하겠습니다.

## Payload, CRC 필드
* Payload 설명:
    * 프레임의 본문으로, 실제 데이터(사용자 데이터 또는 상위 계층 데이터)가 포함됩니다.
* Payload 특징:
    * 상위 계층(예: TCP/IP)의 데이터가 이곳에 실립니다.
    * 데이터의 크기는 0~2304 바이트까지 가능(추가 오버헤드로 인해 최대 2346 바이트).

* CRC 설명: 프레임 끝에 위치하며, 데이터의 오류 검출을 위한 필드입니다.

* CRC 특징:
    * 송신 장치는 CRC 값을 계산하여 프레임에 추가합니다.
    * 수신 장치는 수신된 프레임의 CRC를 재계산하여 일치 여부를 확인하고, 오류가 있으면 프레임을 폐기합니다.

## 주소 필드
IEEE 802.11 프레임은 최대 4개의 주소 필드를 포함하며, 네트워크 환경에 따라 각 주소의 의미가 달라질 수 있습니다.

### Address 2
* 설명:
    * 프레임의 송신자 주소입니다.
    * 데이터를 전송한 장치의 MAC 주소를 포함합니다.
* 예시:
    * 클라이언트에서 AP로 데이터를 보낼 경우: 클라이언트의 MAC 주소.
    * AP에서 클라이언트로 데이터를 보낼 경우: AP의 MAC 주소.

### ADdress 1
*설명:
    *프레임의 최종 목적지 주소입니다.
    *AP(Access Point)나 클라이언트의 MAC 주소가 포함됩니다.
*예시:
    *클라이언트가 데이터를 AP로 전송하는 경우: AP의 MAC 주소.
    *AP가 데이터를 클라이언트로 전송하는 경우: 클라이언트의 MAC 주소.

### Address 3
*설명:
    *최종 목적지의 상위 계층 주소 또는 원래 송신자의 주소를 포함합니다.
    *이 필드는 브리징 또는 라우팅이 필요한 네트워크(예: 인프라 모드)에서 사용됩니다.
*예시:
    *AP가 클라이언트로 데이터를 전달할 때, 최종 데이터의 상위 계층 목적지를 나타냅니다.

## Sequence Number
* 설명:
    * 프레임의 순서를 나타내는 번호로, 프레임 재조립 및 중복 검출에 사용됩니다.
* 특징:
    * 데이터 프레임에 포함된 각 프레임에 고유 번호가 부여됩니다.
    * 최대 12비트로, 번호는 0~4095 범위에서 순환적으로 사용됩니다.

## Duration
* 설명:
    * 네트워크 대기 시간을 설정하는 필드로, 프레임 전송이 완료될 때까지 채널이 차단되는 시간을 나타냅니다.
* 특징:
    * RTS/CTS 또는 데이터 전송 시 채널 점유 시간을 계산하고 이를 다른 장치에 알립니다.
    * 숨은 터미널 문제 해결에 도움을 줍니다.

## Frame Control
* 설명:
* 프레임의 기본 정보를 담고 있으며, 16비트로 구성됩니다.
* 주요 서브필드:
* Protocol Version: 프로토콜 버전(보통 0).
* Type/Subtype: 프레임의 종류(관리, 제어, 데이터 프레임 등).
* To DS/From DS: 프레임의 송수신 방향을 나타냄(분산 시스템 또는 AP를 기준).
* Retry: 재전송 여부를 표시.
* More Fragments: 더 많은 프레임 조각이 있는지 여부를 표시.
* Power Management: 전원 관리 상태를 나타냄.

## 요약
프레임 구조 요약
* Payload: 실제 데이터.
* CRC: 오류 검출.
* Address 1, 2, 3: 송신자, 수신자, 상위 계층 주소를 구분.
* Sequence Number: 프레임의 순서와 중복 검출.
* Duration: 채널 점유 시간.
* Frame Control: 프레임의 기본 설정 정보.

***

# 동일한 IP 서브넷 내에서의 이동성
무선 네트워크에서 장치가 동일한 IP 서브넷 내에서 이동하면서 통신을 유지하는 것을 설명할 때 BSS(Basic Service Set), TCP, IP와 같은 키워드가 중요한 역할을 합니다.

## 이동성의 기본 개념
무선 네트워크에서 동일한 IP 서브넷 내에서 이동성이란, 장치가 네트워크 연결을 유지한 채 **다른 AP(Access Point)**로 이동하는 것을 말합니다.
이 과정은 **BSS(Basic Service Set)**의 변경으로 인해 발생하며, TCP와 IP는 데이터 연결 유지와 전송을 보장하기 위해 필요한 역할을 수행합니다.

## BSS(Basic Service Set)
BSS는 무선 네트워크에서 AP와 그것에 연결된 장치들이 구성하는 네트워크의 기본 단위입니다.
BSS 변경: 장치가 한 AP에서 다른 AP로 이동하는 것을 의미.
ESS(Extended Service Set): 여러 BSS가 동일한 IP 서브넷에 속해 있어, 장치가 BSS 간 이동해도 IP 주소를 변경할 필요가 없는 구조.

## 이동 중 통신 유지의 메커니즘
1. AP 간의 핸드오프(Handoff)
장치가 현재 연결된 AP의 범위를 벗어나 다른 AP의 범위로 진입하면 핸드오프가 발생합니다.
새로운 AP와 association(결합) 과정을 수행.
핸드오프는 BSS 간의 전환이지만, 동일한 IP 서브넷 내에서 이루어지므로 IP 주소는 그대로 유지됩니다.
2. TCP 연결 유지
TCP는 종단 간(end-to-end) 연결을 유지합니다.
동일한 서브넷 내에서는 IP 주소가 변경되지 않기 때문에 TCP 연결이 끊기지 않고 유지됩니다.
핸드오프 동안 일부 데이터 패킷이 손실될 수 있으나, TCP는 재전송 메커니즘을 통해 이를 복구합니다.
3. IP 서브넷 내 이동
동일한 IP 서브넷 내에서 이동할 경우:
장치는 동일한 서브넷 마스크와 게이트웨이를 유지하므로 라우팅에 변화가 없습니다.
데이터는 기존의 IP 라우팅을 통해 전달되며, 핸드오프는 MAC 계층에서 처리됩니다.

## 이동성의 이점과 한계
1. 이점
IP 주소 변경 없음: 장치가 이동해도 동일한 IP 주소를 유지하므로, TCP와 같은 연결 지향 프로토콜이 중단되지 않습니다.
빠른 핸드오프: 핸드오프는 로컬 네트워크 내에서 처리되므로 지연 시간이 최소화됩니다.
2. 한계
핸드오프 지연: AP 간 핸드오프 과정에서 약간의 지연(latency)이 발생할 수 있으며, 이로 인해 짧은 데이터 손실이 생길 수 있습니다.
혼잡 문제: 동일한 IP 서브넷 내에서 많은 장치가 이동하면 네트워크 혼잡이 발생할 가능성이 있습니다.

## 프로토콜 관점에서의 이동성
* BSS: AP 간 핸드오프와 장치 결합을 처리.
* IP: 동일한 서브넷 내에서는 IP 주소가 고정되므로 추가적인 라우팅 작업이 필요 없음.
* TCP: 패킷 손실이 발생하더라도 연결을 유지하며, 재전송으로 데이터 복구.

## 결론
동일한 IP 서브넷 내에서의 이동성은 BSS 변경과 핸드오프를 통해 처리되며, IP 주소 유지와 TCP 연결 복원 메커니즘 덕분에 원활한 통신이 가능합니다. 이는 무선 네트워크에서 끊김 없는 사용자 경험을 제공하는 핵심 요소입니다.