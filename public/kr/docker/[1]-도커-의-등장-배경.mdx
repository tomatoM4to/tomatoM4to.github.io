# 가상화

기본적으로 Docker 를 이해하기 전 가상화 기술에 대해 짚고 넘어가 봅시다.

일단 컴퓨터란 무엇으로 구성되어 있을까에 대한 질문부터 해야 합니다. 컴퓨터는 CPU, RAM, SSD or HDD 같은 물리적인 장치들과 해당 장치들을 제어하는 소프트웨어로 구성되어 있습니다. 그리고 이런 소프트웨어는 OS 와 Application 으로 나눌 수 있습니다.

Application 은 하나 또는 여러개의 Process 로 구성되어 있고 이러한 Process 는 OS 가 관리하게 됩니다. 또한 이런 Process 는 철저하게 독립된 실행 환경을 가지고 있죠, 예를들어, vscode 를 실행하고 있는데 vscode 의 연산 데이터가 Chrome 영역에 영향을 주면 절대 안되겠죠? 그래서 OS 는 각 Process 가 독립적으로 실행될 수 있도록 관리합니다.

여기까지 배경지식이 있다면 충분합니다.

## vmware

지금부터 본격적으로 예기하자면

vmware 같은 경우 Windows 에서 여러개의 Linux 를 구동할 수 있게 해줄 수 있습니다. 이러한 OS 들을 Guest OS 라 고 부릅니다.

이때 중요한 점은 하드웨어도 소프트웨어적으로 구현한단 점 이 중요합니다.

자 아래 그림을 봅시다.

아래 그림은 Windows 에서 두개의 Linux 를 구동하고 각 Linux 에는 하나의 Process 가 실행되고 있는 상황인걸 볼 수 있습니다.

이때 한번 개수를 새보죠, 해당 그림에선 몇개의 프로그램이 돌까요?

1. Host OS: Window kernel, Process1
2. Linux1: Process2, Linux kernel, hardware
3. Linux2: Process3, Linux kernel, hardware


단순 개수만 셌는데도 총 8개의 프로그램이 돌아가고 있네요. 근데 여기서 한번 더 볼점은 우리가 이러한 Linux 를 굳이 번거롭게 설치를 한 이유는 뭘까요? 바로 Process2 와 Process3 을 Window 에서 격리된 환경에서 실행하기 위함입니다. 그러므로 Process2 와 Process3 이 두개의 프로그램 때문에 Linux kernel 과 hardware 같은 무거운 프로그램이 돌아가고 있는 상황입니다. 그냥 봐도 이런 구조는 비효율적이죠.

여기서 Container 기술의 아이디어가 등장합니다. Linux kernel 와 hardware 은 굳이 필요할까?

## Docker

해당 그림은 쿠버네티스 문서에서 가져온 이미지인데 한번 살펴봅시다.

Container 기술은 쉽게 굳이 **OS 를 설치하지 않고**, Application 을 실행하기 위한 필수 환경만 추상화 하는걸로 이해할 수 있습니다. 이런 추상화된 한 묶음을 Container 라고 부릅니다.

그리고 위 그림에서 Virtual Machine 와 Hypervisor(Docker 이해에 중요한건 아니니 설명 생략) 은 Container Runtime 로 대신 해준다는 개념입니다.

그렇다고 해서 각 Container 가 OS 의 기능을 전혀 사용하지 않는건 아닙니다. Container Runtime 이 OS 의 기능을 대신 해주는 것이죠.

조금더 정확히 말하면, 마치 Chrome 에서 여러 독립된 탭을 열수 있는것 처럼, 같은 Host OS 를 Container Runtime 각 Container 에게 공유 하는 형태가 됩니다.

이런 아이디어가 왜 나왔냐면 hardware 야 뭐 다 같은 hardware 고 OS 도 뭐 Linux 쓸거면 굳이 중복해서 쓸 필요난 없어 보이잖아요? 그래서 프로그램을 실행하기 위한 필수적인 요소만 남긴 Container 기술이 등장하게 된 것입니다.

그리고 이러한 Container 를 실행하기 ㅟ해선 또 Kernel 와 Hardware 가 필요한데, 이건 또 Docker Runtime 이 대신 해주는 것이죠.

만약 Container 과 System Call 이 필요하다면 Docker Runtime 이 이를 대신 해 주는 개념이죠, Container 가 Hardware 가 더 필요하다면, Docker Runtime 에게 요청하고 Docker Runtime 이 Container 에게 전달하는 구조입니다.

이러면 굳이 Application 몇개 실행하기 위해 OS 를 여러개 설치할 필요가 없겠죠? 그래서 효율이 정말 급격하게 좋아집니다. 대충 수치상으로 2배 이상 좋아진다 봐도 무방합니다.

배포하기 용이해준다는것 또한 장점이죠, 그냥 Container 만 공장처럼 제작해 뿔려버리면 끝나니까요.

***

# Docker

컨테이너 기반의 가상화 플랫폼이며 오픈소스임

어떤 프로그램(FastAPI, Spring 등)을 외부 환경(OS 라 생각 하면 됨)과 격리시켜 구동할 수 있게 해주는 소프트웨어

예를들어, Windows 에서 잘 돌아가는 프로그램이 Linux 에서도 잘 돌아간다고 장담할 수 있을까? 실제로 장담 못하고 프로그램이 자주 충돌나게 됨, 이를 해결해줌

보통 Server 쪽에서 많이 사용됨

## Container

TODO: 여러 가상화 OS 기술들 설명

Docker 같은 경우는 OS 상에 논리적인 영역(Container) 을 구축하고, 애플리케이션이 작동하는데 필요한 요소들을 모아 별도의 서버처럼 동작하는 것

여기서 논리적인 영역인 Container 는 나중에 자세히 다루겠지만 지금은 그냥 Linux 의 커널을 Process 단위로 나누어 두고, 해당 Process 위에 애플리케이션을 올려놓는다고 이해해도 사용하는데 문제 없음, 물론 정확한 설명은 아니고 그냥 이해를 돕기 위한 설명임

이렇게 생각하면 각 독립된 Container 가, 어떻게 OS 에 구애받지 않고 앱을 동작시킬 수 있는지에 대한 대략적인 이해가 가능할듯 함

Docker 이외에도 Container 가상화 기술은 Podman 등 여러가지가 존재

TODO: VM vs Docker 의 비교

VM 은 실제 OS 를 가상화? 설치? 하는거지만 Docker Container 는 Linux 커널의 일부분만 가져다가 아주 작은 OS 처럼 돌아가게끔 하는 것, 그래서 보통 오버해드가 적다고 함



